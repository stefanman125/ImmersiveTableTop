
async function loadJsonFile(url) {
    try {
        // Add a cache-busting query parameter to the URL
        const cacheBusterUrl = `${url}?t=${new Date().getTime()}`;
        const response = await fetch(cacheBusterUrl);
        
        if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
        }
        const data = await response.json();
        return data; // Return the parsed data directly
    } catch (error) {
        console.error('Error loading JSON file:', error);
    }
}

function changeToPeace() {

}

function changeToWar() {
    // Change "No signal" gif to another one
    const noSignalGif = document.getElementById("no-signal-gif");
    noSignalGif.src = warNoSignalUrl;

    // Change gamestate text
    const gameStateText = document.getElementById("gamestate-text");
    gameStateText.textContent = "PEACE BROKEN";
    gameStateText.style.color = "rgba(255, 0, 0, 1)";

    // Change Background
    const backgroundVideo = document.getElementById("background-video");
    const backgroundVideoSource = document.getElementById("background-video-source")
    backgroundVideoSource.src = backgroundSrcWar;
    backgroundVideo.load();

    // Change Title
    const titleText = document.getElementById("title-text");
    titleText.style.color = "rgba(255, 0, 0, 1)";

    // Change Visualizer and text
    visualizerBarColor = "rgba(255, 0, 0, 1)";
    const visualizerText = document.getElementById("visualizer-text");
    visualizerText.style.color = "rgba(255, 0, 0, 1)";

    // Change news feed color and text
    const newsBar = document.getElementById("news-bar");
    newsBar.style.backgroundColor = "rgba(255, 0, 0, 0.7)";
    newsHeadlines.textContent = warHeadlines;

    // Change leaderboard colors
    const objectivesTable = document.getElementById("objectives-table");
    objectivesTable.style.backgroundColor = "rgba(255, 0, 0, 0.7)";
    const playersTable = document.getElementById("players-table");
    playersTable.style.backgroundColor = "rgba(255, 0, 0, 0.7)";

    // Change videos to war videos
    currentVideos = warVideos;
    shuffledVideoPlaylist = shuffle(currentVideos); 
    playNextVideo();

    // Music change is handled in the admin panel, since it requires creds to call the music override
}

async function checkGameState() {
    const intervalId = setInterval(async () => {
        const gamedata = await loadJsonFile(gamedataFileUrl);
        
        // Check if gamedata exists and gameState is set to "War"
        if (gamedata && gamedata.gameState === "War") {
            clearInterval(intervalId); // Stop further checks
            changeToWar();
        }
    }, 5000); 
}

checkGameState();